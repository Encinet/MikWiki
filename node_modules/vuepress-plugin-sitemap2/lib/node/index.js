"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/utils"),t=require("sitemap");const a=[],s=e=>({defaultPath:e.path.replace(e.pathLocale,"/"),pathLocale:e.pathLocale}),n=async(n,r)=>{const{excludeUrls:i=[],extraUrls:p=[],xmlNameSpace:l}=r,o=r.hostname.replace(/\/$/u,""),c=r.sitemapFilename?r.sitemapFilename.replace(/^\//u,""):"sitemap.xml",{dir:u,options:{base:m}}=n;await e.withSpinner(`Generating sitemap to ${e.chalk.cyan(c)}`)((()=>new Promise((d=>{const h=new t.SitemapStream({hostname:o,xmlns:l}),g=((t,n)=>{const{changefreq:r="daily",excludeUrls:i=["/404.html"],modifyTimeGetter:p=(e=>e.data.git?.updatedTime?new Date(e.data.git.updatedTime).toISOString():"")}=n,{pages:l,options:{base:o,locales:c}}=t,u=l.reduce(((e,t)=>{const{defaultPath:a,pathLocale:n}=s(t),r=e.get(a)||[];return r.push(n),e.set(a,r)}),new Map),m=new Map;return l.forEach((n=>{const l=n.frontmatter.sitemap||{},d=(n.frontmatter.head||[]).find((e=>"robots"===e[1].name));(d?(d[1].content||"").split(/,/u).map((e=>e.trim())).includes("noindex"):l.exclude)&&i.push(n.path);const h=p(n),{defaultPath:g}=s(n),f=u.get(g)||[];let w=[];f.length>1&&(t.env.isDebug&&f.forEach((t=>{c[t].lang||a.includes(t)||(e.logger.warn(`[@vuepress/plugin-sitemap] 'lang' option for ${t} is missing`),a.push(t))})),w=f.map((e=>({lang:c[e].lang||"en",url:`${o.replace(/\/$/,"")}${g.replace(/^\//u,e)}`}))));const $={changefreq:r,links:w,...h?{lastmod:h}:{},...l};t.env.isDebug&&e.logger.info(`[@vuepress/plugin-sitemap] sitemap option for ${n.path}`,$),m.set(n.path,$)})),n.excludeUrls=i,m})(n,r),f=u.dest(c),w=e.fs.createWriteStream(f);h.pipe(w),g.forEach(((e,t)=>{i.includes(t)||h.write({url:`${m}${t.replace(/^\//u,"")}`,...e})})),p.forEach((e=>h.write({url:`${m}${e.replace(/^\//u,"")}`}))),h.end((()=>{d()}))}))));const d=u.dest("robots.txt");e.fs.existsSync(d)&&await e.withSpinner(`Appended sitemap path to ${e.chalk.cyan("robots.txt")}`)((async()=>{const t=`${(await e.fs.readFile(d,{encoding:"utf8"})).replace(/^Sitemap: .*$/u,"")}\nSitemap: ${o}${m}${c}\n`;await e.fs.writeFile(d,t,{flag:"w"})}))},r=(t,a)=>{const s={name:"vuepress-plugin-sitemap2"};return t.hostname?{...s,async onGenerated(){await n(a,t)}}:(e.logger.warn(`[${s.name}] 'hostname' is required`),s)};exports.default=r,exports.sitemap=e=>["sitemap2",e],exports.sitemapPlugin=r;
//# sourceMappingURL=index.js.map
