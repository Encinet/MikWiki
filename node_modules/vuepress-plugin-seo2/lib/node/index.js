"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/core"),t=require("@mr-hope/vuepress-shared"),r=require("@vuepress/utils");const a=new t.Logger("vuepress-plugin-seo2"),s=(e,t,r)=>`${e.match(/https?:\/\//)?"":"https://"}${e.replace(/\/$/u,"")}${t}${r.replace(/^\//u,"")}`,n=(e,{name:t,content:r,attribute:a=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{r&&e.push(["meta",{[a]:t,content:r}])},o=e=>" "===e||"\n"===e||"\r"===e||"\t"===e;class i{consume(e,t){return"<"===e?(t(new c),""):e}}class c{constructor(){this.nameBuffer=""}consume(e,t){if(0===this.nameBuffer.length){if(o(e))return t(new i),"<"+e;if("/"===e)return""}return o(e)?(t(new l(1)),""):"<"==e?(this.nameBuffer+="&lt;",""):">"==e?(t(new i),""):"-"==e&&"!-"==this.nameBuffer?(t(new m),""):(this.nameBuffer+=e,"")}}class l{constructor(e){this.mode=e}consume(e,t){return">"==e?t(new i):(e=>'"'===e||"'"===e)(e)&&t(new u(this.mode,e)),1==this.mode?"":"<"==e?"&lt;":e}}class u{constructor(e,t){this.mode=e,this.quoteCharacter=t}consume(e,t){return e==this.quoteCharacter&&t(new l(this.mode)),1==this.mode?"":"<"==e?"&lt;":">"==e?"&gt;":e}}class m{constructor(){this.consecutiveHyphens=0}consume(e,t){return">"==e&&this.consecutiveHyphens>=2?t(new i):"-"==e?this.consecutiveHyphens++:this.consecutiveHyphens=0,""}}class p{constructor(){this.state=new i,this.transitionFunction=e=>{this.state=e}}consume(e){let t="";for(const r of e)t+=this.state.consume(r,this.transitionFunction);return t}}const g=(o,i)=>o.hostname?{name:"vuepress-plugin-seo2",extendsPage(r){var a;r.frontmatter.description||(r.frontmatter.summary=((e="")=>e?(new p).consume(e):"")(r.excerpt)||(a=r.content,a?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(a).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||"");const c=r.frontmatter.head||[],l={page:r,app:i,permalink:e.resolvePagePermalink(r)},{OGP:u,JSONLD:m}=((e,{page:r,app:a,permalink:n})=>{const{isArticle:o=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=e,{base:i}=a.options,{frontmatter:{author:c,time:l,date:u=l,banner:m,cover:p,tag:g,tags:h=g},git:d={}}=r,{siteData:f}=a,w=((e={},t)=>{const r=[];for(const t in e)e[t].lang&&r.push(e[t].lang);return r.filter((e=>e!==t))})(f.locales,r.lang),$=!1===c?[]:t.getAuthor(c||e.author),{updatedTime:v}=d,y=v?new Date(v).toISOString():"",b=Array.isArray(h)?h:"string"==typeof g?[g]:[],x=r.title,S=p?s(e.hostname,i,p):m?s(e.hostname,i,m):"";let D="";if(u instanceof Date)D=new Date(u).toISOString();else if(u){const e=t.getDate(u);e&&e.value&&(D=e.value.toISOString())}return{OGP:{"og:url":s(e.hostname,i,n||r.path),"og:site_name":f.title,"og:title":x,"og:description":r.frontmatter.description||"","og:type":o(r)?"article":"website","og:image":S,"og:updated_time":y,"og:locale":r.lang,"og:locale:alternate":w,"twitter:card":"summary_large_image","twitter:image:alt":f.title,"article:author":$[0]?.name,"article:tag":b,"article:published_time":D,"article:modified_time":y},JSONLD:o(r)?{"@context":"https://schema.org","@type":"NewsArticle",headline:x,image:[S],datePublished:D,dateModified:y,author:$.map((e=>({"@type":"Person",...e})))}:null}})(o,l),g=o.ogp?o.ogp(u,l):u,h=o.jsonLd?o.jsonLd(m,l):null;((e,t,r)=>{for(const r in t)switch(r){case"article:tag":t["article:tag"].forEach((t=>n(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((r=>{r!==t["og:locale"]&&n(e,{name:"og:locale:alternate",content:r})}));break;default:t[r]&&n(e,{name:r,content:t[r]})}r.restrictions&&n(e,{name:"og:restrictions:age",content:r.restrictions}),r.twitterID&&n(e,{name:"twitter:creator",content:r.twitterID})})(c,g,o),h&&c.push(["script",{type:"application/ld+json"},JSON.stringify(h)]),o.customHead&&o.customHead(c,l),r.frontmatter.head=c},async onGenerated(){await(async e=>{a.load("Generating robots.txt");const t=e.public("robots.txt");let s=r.fs.existsSync(t)?await r.fs.readFile(t,{encoding:"utf8"}):"";s&&!s.includes("User-agent")?(a.error(),a.update("robots.txt seems invalid!")):(s+="\nUser-agent:*\nDisallow:\n",await r.fs.writeFile(e.dest("robots.txt"),s,{flag:"w"}),a.succeed())})(i.dir)}}:(a.error("Option 'hostname' is required!"),{name:"vuepress-plugin-seo2"});exports.default=g,exports.seo=e=>["seo2",e],exports.seoPlugin=g;
//# sourceMappingURL=index.js.map
